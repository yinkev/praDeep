# ============================================
# praDeep Docker Compose - Development Override
# ============================================
# Use with: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
#
# This override file provides:
#   - Hot-reload for both frontend and backend
#   - Source code mounting for live editing
#   - Development-friendly logging
# ============================================

services:
  deeptutor:
    build:
      target: development

    volumes:
      # Mount source code for hot-reload (read-only to prevent accidental writes)
      - ./src:/app/src:ro
      - ./config:/app/config:ro
      - ./scripts:/app/scripts:ro

      # Mount frontend source for hot-reload
      - ./web/app:/app/web/app:ro
      - ./web/components:/app/web/components:ro
      - ./web/lib:/app/web/lib:ro
      - ./web/hooks:/app/web/hooks:ro
      - ./web/context:/app/web/context:ro
      - ./web/types:/app/web/types:ro
      - ./web/public:/app/web/public:ro

      # Mount data directories (writable) - output to local ./data
      - ./data/user:/app/data/user
      - ./data/knowledge_bases:/app/data/knowledge_bases

    environment:
      - NODE_ENV=development
      # Enable more verbose logging in development
      - RAG_TOOL_MODULE_LOG_LEVEL=${RAG_TOOL_MODULE_LOG_LEVEL:-DEBUG}

    # In development, we might want to see logs directly
    # Uncomment the following to disable log files and see everything in console
    # logging:
    #   driver: "json-file"
    #   options:
    #     max-size: "10m"
    #     max-file: "3"

    networks:
      - deeptutor-network
