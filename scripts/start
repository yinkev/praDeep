#!/usr/bin/env python3
from __future__ import annotations

import argparse
import os
from pathlib import Path
import sys


def _project_root() -> Path:
    return Path(__file__).resolve().parent.parent


def _venv_python(root: Path) -> Path:
    if os.name == "nt":
        return root / ".venv" / "Scripts" / "python.exe"
    return root / ".venv" / "bin" / "python"


def _build_command(root: Path) -> list[str]:
    venv_python = _venv_python(root)
    python_exe = str(venv_python if venv_python.exists() else sys.executable)
    return [python_exe, str(root / "scripts" / "start_web.py")]


def main() -> int:
    parser = argparse.ArgumentParser(description="Start praDeep backend + frontend")
    parser.add_argument("--dry-run", action="store_true", help="Print the command without running it")
    args = parser.parse_args()

    root = _project_root()
    cmd = _build_command(root)

    if args.dry_run:
        print(" ".join(cmd))
        return 0

    os.execv(cmd[0], cmd)
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
